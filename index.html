<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>مركز ابن كثير</title>
   
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

   
    <style>
        :root {
            --primary: #1e40af; --primary-dark: #1e3a8a; --accent: #d97706;
            --success: #059669; --danger: #dc2626; --bg: #f3f4f6;
            --card-bg: #ffffff; --text: #1f2937; --text-light: #6b7280;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg); color: var(--text); padding-bottom: 90px; }
        h1, h2, h3 { font-family: 'Amiri', serif; }
        
        .main-header { background: linear-gradient(135deg, var(--primary-dark), var(--primary)); color: white; padding: 20px; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; box-shadow: var(--shadow); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.3rem; font-weight: bold; display: flex; align-items: center; gap: 10px; }


        <link rel="icon" type="image/png" href="icon.png">
        
        .page-section { display: none; padding: 20px; animation: slideUp 0.4s ease-out; }
        .page-section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 20px; border-radius: 16px; box-shadow: var(--shadow); margin-bottom: 20px; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text); font-size: 0.95rem; }
        
        input, select, textarea {
            width: 100%; padding: 14px; margin-bottom: 5px; border: 2px solid #e5e7eb; border-radius: 12px;
            font-size: 1rem; font-family: 'Tajawal', sans-serif; transition: all 0.3s ease; background: #fafafa;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        
        .btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: transform 0.1s; box-shadow: var(--shadow); display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn:active { transform: scale(0.98); }
        .btn-success { background: var(--success); } .btn-danger { background: var(--danger); } .btn-gold { background: var(--accent); color: white; }
        
        .profile-header { text-align: center; margin-bottom: 20px; }
        .profile-img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: all 0.3s; }
        .teacher-name { font-size: 1.2rem; font-weight: bold; margin-top: 10px; color: var(--primary-dark); }
        .teacher-role { font-size: 0.85rem; color: #666; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-top: 1px solid rgba(0,0,0,0.05); display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; box-shadow: 0 -4px 20px rgba(0,0,0,0.03); }
        .nav-item { text-align: center; color: #9ca3af; font-size: 0.75rem; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.4rem; display: block; margin-bottom: 4px; }

        .data-item { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; border-right: 4px solid var(--primary); box-shadow: var(--shadow); }
        .status-tag { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .tag-present { background: #d1fae5; color: #065f46; } .tag-absent { background: #fee2e2; color: #991b1b; }

        /* ٹیبس کا اسٹائل */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: #e5e7eb; border-radius: 8px; font-weight: bold; color: #666; cursor: pointer; }
        .tab-btn.active { background: var(--primary); color: white; }

        .contact-card { display: flex; align-items: center; padding: 15px; background: #f9fafb; border-radius: 12px; margin-bottom: 10px; text-decoration: none; color: var(--text); transition: 0.3s; }
        .contact-card:hover { background: #e0e7ff; transform: translateX(-5px); }
        .icon-box { width: 45px; height: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; margin-left: 15px; box-shadow: var(--shadow); }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="logo">
            <img src="https://flagcdn.com/w40/bh.png" style="width: 24px; border-radius: 50%; border:2px solid white;" alt="BH">
            <span>مركز ابن كثير</span>
        </div>
        <div style="font-size: 0.8rem; opacity: 0.9;">نظام متكامل</div>
    </header>

    <!-- 1. ہوم پیج -->
    <div id="home" class="page-section active">
        <div style="text-align: center; margin-bottom: 25px;">
            <h1 style="font-size: 1.8rem; color: var(--primary); margin-bottom: 5px;">مرحباً بكم</h1>
            <p style="color: var(--text-light);">رفاع الغربی - مملكة البحرين</p>
        </div>
        <div class="card" style="text-align: center; border-top: 5px solid var(--accent);">
            <i class="fas fa-quran" style="font-size: 3rem; color: var(--primary); margin-bottom: 10px;"></i>
                    <!-- ======== یہ نیا کارڈ مدیر (Supervisor) کے لیے ہے ======== -->
        <div class="card" style="text-align: center; border-top: 5px solid var(--accent);">
            <!-- مدیر کا آئیکن -->
            <!-- <i class="fas fa-user-tie" style="font-size: 2.5rem; color: var(--accent); margin-bottom: 10px;"></i> -->
                         <img id="teacherImage" src="https://github.com/ghulamaliawan91/ibn_katheer_almakki/blob/main/%D8%AC%D9%85%D8%B9%D8%A7%D9%86.png" alt="Teacher"> 
            <!-- https://picsum.photos/seed/teacher1/150/150 -->

        
            <!-- ٹائٹل -->
            <h3 style="color: var(--accent); margin-bottom: 5px;">المشرف العام</h3>
            
            <!-- نام -->
            <p style="font-size: 1.2rem; color: var(--primary-dark); font-weight: bold; margin: 5px 0;">الشيخ الجمعان جاسم الروی</p>
            
            <!-- ذمہ داری -->
            <p style="font-size: 0.9rem; color: #666;">إمام وخطيب المسجد عمر بن علی بن سلطان الرئيسي المرکز ابن کیثر المکی</p>
            
            <!-- تفصیل جو آپ نے پوچھا تھا -->
            <p style="font-size: 0.85rem; color: #555; margin-top: 15px; line-height: 1.8;">
                يعمل المركز كله تحت إشراف ومتابعة الشيخ الجمعان جاسم الروی (حفظه الله)، المشرف العام على المركز.
            </p>
        </div>
            <h3>المساجد السبعة</h3>
            <p style="margin-top: 10px; color: #666; line-height: 1.8;">مسجد عمر بن سلطان (المقر)<br>مسجد الشيخ عيسى الخليفة<br>باقي المساجد</p>
        </div>
    </div>

    <!-- 2. معلمون -->
    <div id="teachers" class="page-section">
        <div class="profile-header">
            <img id="teacherImage" src="https://picsum.photos/seed/teacher1/150/150" class="profile-img" alt="Teacher">
            <div id="teacherName" class="teacher-name">شیخ الجمعان جاسم</div>
            <div id="teacherRole" class="teacher-role">المشرف العام</div>
        </div>

        <h2 style="margin-bottom: 20px; color: var(--primary); text-align: center;">تسجيل الحضور</h2>
        <div class="card">
            <div class="form-group">
                <label><i class="fas fa-mosque"></i> اختر المسجد</label>
                <select id="t_mosque" onchange="updateCircles()">
                    <option value="مسجد عمر بن سلطان بن علی">مسجد عمر بن سلطان بن علی</option>
                    <option value="مسجد الشيخ عيسى الخليفة">مسجد الشيخ عيسى الخليفة</option>
                    <option value="مسجد 3">مسجد 3</option>
                    <option value="مسجد 4">مسجد 4</option>
                    <option value="مسجد 5">مسجد 5</option>
                    <option value="مسجد 6">مسجد 6</option>
                    <option value="مسجد 7">مسجد 7</option>
                </select>
            </div>

            <div class="form-group">
                <label><i class="fas fa-chalkboard-teacher"></i> اختر الحلقة/المعلم</label>
                <select id="t_circle" onchange="updateTeacher()"></select>
            </div>

            <div class="form-group">
                <label><i class="fas fa-user-graduate"></i> اسم الطالب</label>
                <input type="text" id="t_student" placeholder="اكتب اسم الطالب هنا...">
            </div>

            <div class="form-group">
                <label><i class="fas fa-check-circle"></i> الحالة</label>
                <select id="t_status">
                    <option value="حاضر">حاضر</option>
                    <option value="غائب">غائب</option>
                </select>
            </div>

            <div class="form-group">
                <label><i class="fas fa-sticky-note"></i> ملاحظات</label>
                <textarea id="t_notes" rows="3" placeholder="تفاصيل الحفظ..."></textarea>
            </div>

            <button class="btn btn-success" id="btnAttend" onclick="sendData('Attendance')">
                <i class="fas fa-paper-plane"></i> إرسال الحضور
            </button>
        </div>
    </div>

    <!-- 3. مدیر -->
    <div id="admin" class="page-section">
        <div id="loginPanel" class="card" style="text-align: center; max-width: 400px; margin: 0 auto;">
            <img src="https://picsum.photos/seed/sheikhjasm/150/150" class="profile-img" alt="Supervisor" style="margin-bottom: 10px;">
            <h2>الدخول المشرف</h2>
            <input type="password" id="passInput" placeholder="كلمة المرور" style="text-align: center; letter-spacing: 2px;">
            <button class="btn" onclick="login()">دخول</button>
        </div>

        <div id="dashboardPanel" style="display: none;">
            <div class="card" style="background: var(--primary); color: white; display: flex; justify-content: space-between; align-items: center;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <img src="https://picsum.photos/seed/sheikhjasm/50/50" style="width:40px; height:40px; border-radius:50%; border:2px solid white;">
                    <div><h3>لوحة التحكم</h3><p style="font-size: 0.8rem; opacity: 0.8;">الشيخ جاسم</p></div>
                </div>
                <button class="btn btn-danger" style="width: auto; padding: 8px 15px; font-size: 0.9rem;" onclick="logout()">خروج</button>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                    <i class="fas fa-list-alt"></i> التقارير
                </h3>
                <!-- ٹیبس -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('Attendance', this)">سجل الحضور</button>
                    <button class="tab-btn" onclick="switchTab('Exams', this)">سجل الامتحانات</button>
                </div>

                <div id="listContainer" style="max-height: 500px; overflow-y: auto;"></div>
                
                <button class="btn" style="background: #e5e7eb; color: #374151; margin-top: 15px;" onclick="loadData()">
                    <i class="fas fa-sync"></i> تحديث
                </button>
            </div>
        </div>
    </div>

    <!-- 4. امتحانات -->
    <div id="exams" class="page-section">
        <h2 style="margin-bottom: 20px; color: var(--accent); text-align: center;">تسجيل الامتحانات</h2>
        <div class="card">
            <div class="form-group">
                <label><i class="fas fa-mosque"></i> المسجد</label>
                <select id="e_mosque">
                    <option>مسجد عمر بن سلطان</option>
                    <option>مسجد 2</option>
                </select>
            </div>

            <div class="form-group">
                <label><i class="fas fa-user-tie"></i> اسم الممتحن (Examiner)</label>
                <input type="text" id="e_examiner" placeholder="اسم من سيأخذ الامتحان">
            </div>

            <div class="form-group">
                <label><i class="fas fa-user-graduate"></i> اسم الطالب</label>
                <input type="text" id="e_student" placeholder="اسم الطالب...">
            </div>

            <div class="form-group">
                <label><i class="fas fa-file-alt"></i> نوع الاختبار</label>
                <select id="e_type">
                    <option>اختبار حفظ</option>
                    <option>اختبار مراجعة</option>
                </select>
            </div>

            <div class="form-group">
                <label><i class="fas fa-star"></i> الدرجة</label>
                <input type="text" id="e_score" placeholder="مثال: 10/10">
            </div>

            <button class="btn btn-gold" id="btnExam" onclick="sendData('Exams')">
                <i class="fas fa-save"></i> حفظ النتيجة
            </button>
        </div>
    </div>

    <!-- 5. معلومات -->
    <div id="info" class="page-section">
        <div class="card" style="text-align: center;"><h2 style="color: var(--primary);">معلومات التواصل</h2><p style="font-size: 0.9rem; color: #666; margin-top: 10px;">نسعد بخدمتكم</p></div>
        <a href="tel:+97366357733" class="contact-card"><div style="flex: 1;"><h4 style="margin-bottom: 2px;">الهاتف</h4><span style="font-size: 0.85rem; color: #666;">+973 6635 7733</span></div><div class="icon-box" style="color: green;"><i class="fas fa-phone-alt"></i></div></a>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <a href="https://wa.me/97366357733" target="_blank" class="btn btn-success" style="margin-top:0; text-decoration: none;"><i class="fab fa-whatsapp"></i> واتساب</a>
            <a href="https://www.instagram.com/ibn_katheer_almakki/" target="_blank" class="btn" style="margin-top:0; background: #C13584; text-decoration: none;"><i class="fab fa-instagram"></i> انستقرام</a>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="showPage('home')"><i class="fas fa-home"></i><span>الرئيسية</span></div>
        <div class="nav-item" onclick="showPage('teachers')"><i class="fas fa-user-check"></i><span>حضور</span></div>
        <div class="nav-item" onclick="showPage('exams')"><i class="fas fa-clipboard-check"></i><span>امتحانات</span></div>
        <div class="nav-item" onclick="showPage('admin')"><i class="fas fa-user-shield"></i><span>مشرف</span></div>
        <div class="nav-item" onclick="showPage('info')"><i class="fas fa-info"></i><span>اتصال</span></div>
    </nav>

    <script>
        const URL = 'https://script.google.com/macros/s/AKfycbxDR4kG5BJMe8lNFCSkcxuj3U0-m3bG18j0sslaRNDiuSqGLc0QrcfyOE6inPZhQ1d4/exec'; 

        // --- 7 مساجد اور معلموں کا ڈیٹا ---
        const teachersData = {
            "مسجد عمر بن سلطان بن علی": [
                { name: "حلقة الشيخ احمد حسن ", role: "المشرف العام", img: "https://picsum.photos/seed/sheikhjasm/150/150" },
                { name: "حلقة أبو الخير (نائب)", role: "نائب الإمام", img: "https://picsum.photos/seed/abulkhair/150/150" },
                { name: "حلقة الشيخ أحمد", role: "معلم", img: "https://picsum.photos/seed/sheikhahmed/150/150" },
                { name: "حلقة 4", role: "معلم", img: "https://picsum.photos/seed/tea4/150/150" },
                { name: "حلقة 5", role: "معلم", img: "https://picsum.photos/seed/tea5/150/150" }
            ],
            "مسجد الشيخ عيسى الخليفة": [
                { name: "الممتحن شیخ سامی", role: "العمام", img: "https://www.instagram.com/p/C0xDy3SLNEk/?hl=ar&img_index=1" },
                { name: "حلقة 2", role: "معلم", img: "https://picsum.photos/seed/t2/150/150" },
                { name: "حلقة 3", role: "معلم", img: "https://picsum.photos/seed/t3/150/150" },
                { name: "حلقة 4", role: "معلم", img: "https://picsum.photos/seed/t4/150/150" },
                { name: "حلقة 5", role: "معلم", img: "https://picsum.photos/seed/t5/150/150" }
            ],
            "مسجد 3": [{ name: "معلم 1", role: "معلم", img: "https://picsum.photos/seed/d3t1/150/150" }],
            "مسجد 4": [{ name: "معلم 1", role: "معلم", img: "https://picsum.photos/seed/d4t1/150/150" }],
            "مسجد 5": [{ name: "معلم 1", role: "معلم", img: "https://picsum.photos/seed/d5t1/150/150" }],
            "مسجد 6": [{ name: "معلم 1", role: "معلم", img: "https://picsum.photos/seed/d6t1/150/150" }],
            "مسجد 7": [{ name: "معلم 1", role: "معلم", img: "https://picsum.photos/seed/d7t1/150/150" }]
        };

        // --- Global Variables ---
        let currentSheet = 'Attendance'; // ڈیفالٹ شیٹ

        function showPage(id) {
            document.querySelectorAll('.page-section').forEach(d => d.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');
            window.scrollTo(0,0);
        }

        // --- Update Circles & Teacher Profile ---
        function updateCircles() {
            const mosque = document.getElementById('t_mosque').value;
            const circleSelect = document.getElementById('t_circle');
            circleSelect.innerHTML = '';
            teachersData[mosque].forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher.name;
                option.innerText = teacher.name;
                option.setAttribute('data-img', teacher.img);
                option.setAttribute('data-role', teacher.role);
                circleSelect.appendChild(option);
            });
            updateTeacher();
        }

        function updateTeacher() {
            const circleSelect = document.getElementById('t_circle');
            if(circleSelect.options.length > 0) {
                const option = circleSelect.options[circleSelect.selectedIndex];
                document.getElementById('teacherImage').src = option.getAttribute('data-img');
                document.getElementById('teacherName').innerText = option.value;
                document.getElementById('teacherRole').innerText = option.getAttribute('data-role');
            }
        }

        // --- Send Data ---
        function sendData(type) {
            let btnId = type === 'Attendance' ? 'btnAttend' : 'btnExam';
            let btn = document.getElementById(btnId);
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> جاري الإرسال...';
            btn.classList.add('loading');
            btn.disabled = true;

            let data = new FormData();
            data.append('sheet', type);
            
            if(type === 'Attendance') {
                const student = document.getElementById('t_student').value;
                if(!student) { alert('براہ کرم نام لکھیں'); return resetBtn(); }
                
                data.append('Mosque', document.getElementById('t_mosque').value);
                data.append('Circle', document.getElementById('t_circle').value); // حلقہ کا نام
                data.append('Teacher', document.getElementById('teacherName').innerText); // معلم کا مخصوص نام
                data.append('Student', student);
                data.append('Status', document.getElementById('t_status').value);
                data.append('Notes', document.getElementById('t_notes').value);
            } else {
                const student = document.getElementById('e_student').value;
                const examiner = document.getElementById('e_examiner').value;
                
                if(!student) { alert('براہ کرم نام لکھیں'); return resetBtn(); }
                if(!examiner) { alert('براہ کرم ممتحن کا نام لکھیں'); return resetBtn(); }

                data.append('Mosque', document.getElementById('e_mosque').value);
                data.append('Examiner', examiner); // ممتحن کا نام
                data.append('Student', student);
                data.append('Type', document.getElementById('e_type').value);
                data.append('Score', document.getElementById('e_score').value);
                data.append('Notes', 'امتحان');
            }

            function resetBtn() {
                btn.innerHTML = originalText; btn.classList.remove('loading'); btn.disabled = false;
            }

            fetch(URL, { method: 'POST', body: data, mode: 'no-cors' })
            .then(() => {
                alert("الحمد لله! تم الحفظ بنجاح.");
                if(type === 'Attendance') {
                    document.getElementById('t_student').value = ''; document.getElementById('t_notes').value = '';
                } else {
                    document.getElementById('e_student').value = ''; document.getElementById('e_examiner').value = ''; document.getElementById('e_score').value = '';
                }
                resetBtn();
            })
            .catch(e => { console.log(e); alert("حصل خطأ ما."); resetBtn(); });
        }

        // --- Admin ---
        function login() {
            if(document.getElementById('passInput').value === 'admin123') {
                document.getElementById('loginPanel').style.display = 'none';
                document.getElementById('dashboardPanel').style.display = 'block';
                loadData();
            } else { alert('كلمة المرور غير صحيحة'); }
        }
        function logout() {
            document.getElementById('loginPanel').style.display = 'block';
            document.getElementById('dashboardPanel').style.display = 'none';
        }

        // --- Tabs Switching ---
        function switchTab(sheet, btnElement) {
            currentSheet = sheet;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            loadData();
        }

        // --- Load Data ---
        function loadData() {
            const container = document.getElementById('listContainer');
            container.innerHTML = '<div style="text-align:center; padding:20px; color:#999;"><i class="fas fa-spinner fa-spin"></i></div>';
            
            fetch(URL + '?sheet=' + currentSheet)
            .then(r => r.json())
            .then(data => {
                let html = '';
                if(data.length > 1) {
                    data.slice(1).reverse().forEach(row => {
                        if (currentSheet === 'Attendance') {
                            // Row: 0=Date, 1=Mosque, 2=Circle, 3=Teacher, 4=Student, 5=Status, 6=Notes
                            const status = row[5] || 'حاضر';
                            const badgeClass = status === 'حاضر' ? 'tag-present' : 'tag-absent';
                            html += `<div class="data-item">
                                        <div>
                                            <strong style="font-size:1.1rem; display:block;">${row[4]}</strong>
                                            <span style="font-size:0.85rem; color:#666;">${row[3]} - ${row[2]}</span>
                                            <span style="display:block; font-size:0.8rem; color:#888;">${row[1]}</span>
                                        </div>
                                        <span class="status-tag ${badgeClass}">${status}</span>
                                     </div>`;
                        } else {
                            // Exams: 0=Date, 1=Mosque, 2=Examiner, 3=Student, 4=Type, 5=Score, 6=Notes
                            html += `<div class="data-item">
                                        <div>
                                            <strong style="font-size:1.1rem; display:block;">${row[3]}</strong>
                                            <span style="font-size:0.85rem; color:#666;">Examiner: ${row[2]}</span>
                                            <span style="display:block; font-size:0.8rem; color:#888;">Type: ${row[4]} | Score: ${row[5]}</span>
                                        </div>
                                     </div>`;
                        }
                    });
                } else { html = '<p style="text-align:center; padding:20px; color:#999;">لا يوجد بيانات</p>'; }
                container.innerHTML = html;
            });
        }

        // Initialize
        updateCircles();
    </script>
</body>
</html>


